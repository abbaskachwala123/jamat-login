<!DOCTYPE html>
<html>
<head>
  <title>User - Watch Admin Screen</title>
</head>
<body>
  <h2>User - Watch Admin Screen</h2>
  <video id="video" autoplay playsinline controls></video>

  <script src="firebase.js" type="module"></script>
  <script type="module">
    import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-database.js";

    const db = window.db;
    const video = document.getElementById("video");
    let pc = new RTCPeerConnection();

    pc.ontrack = (event) => {
      video.srcObject = event.streams[0];
    };

    // Listen for admin's offer
    onValue(ref(db, "webrtc/offer"), async snapshot => {
      const offer = snapshot.val();
      if (offer) {
        await pc.setRemoteDescription(offer);

        const answer = await pc.createAnswer();
        await pc.setLocalDescription(answer);

        // Save answer back to Firebase
        set(ref(db, "webrtc/answer"), answer);
      }
    });
  </script>
</body>
</html>
