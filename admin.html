<!DOCTYPE html>
<html>
<head>
  <title>Admin - Share Screen</title>
</head>
<body>
  <h2>Admin - Share Screen</h2>
  <button id="startShare">Start Sharing</button>

  <script src="firebase.js" type="module"></script>
  <script type="module">
    import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-database.js";

    const db = window.db;
    let pc;

    document.getElementById("startShare").onclick = async () => {
      pc = new RTCPeerConnection();

      // Capture screen
      const stream = await navigator.mediaDevices.getDisplayMedia({ video: true, audio: true });
      stream.getTracks().forEach(track => pc.addTrack(track, stream));

      // Save offer in Firebase
      const offer = await pc.createOffer();
      await pc.setLocalDescription(offer);
      set(ref(db, "webrtc/offer"), offer);

      // Listen for answer
      onValue(ref(db, "webrtc/answer"), async snapshot => {
        const answer = snapshot.val();
        if (answer && !pc.currentRemoteDescription) {
          await pc.setRemoteDescription(answer);
        }
      });
    };
  </script>
</body>
</html>
